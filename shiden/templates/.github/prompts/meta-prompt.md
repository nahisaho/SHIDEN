# メタプロンプト生成スキル

> ユーザーのリクエストを構造化し、質の高い教育コンテンツを生成するためのメタプロンプトを作成します。

## 概要

このスキルは、曖昧または不完全なリクエストを受け取り、以下のプロセスで最適化されたメタプロンプトを生成します：

1. プロンプト強化（暗黙の前提を明示化）
2. 強化プロンプト確認（ユーザーへの確認）
3. コンテキスト収集（1問1答形式）
4. メタプロンプト生成

## Phase 1: プロンプト強化

ユーザーのリクエストを受け取ったら、以下の観点で分析・強化します：

### 分析観点

1. **曖昧な表現の特定**
   - 「わかりやすい」「良い」などの主観的表現
   - 具体的な基準が不明な表現

2. **暗黙の前提の明示化**
   - 対象学年・教科の推測
   - 想定される学習者像
   - 期待される成果物の形式

3. **欠落要素の特定**
   - 時間・リソースの制約
   - 評価基準
   - 特別な配慮事項

### 出力形式

```
📝 あなたのリクエストを以下のように理解しました：

【元のリクエスト】
{ユーザーの元のリクエスト}

【強化されたリクエスト】
{構造化・明確化されたリクエスト}

【補足した要素】
- {暗黙の前提1}
- {暗黙の前提2}

👉 この理解で正しいですか？修正があればお知らせください。
```

## Phase 2: コンテキスト収集（1問1答）

強化プロンプトが確認されたら、不足している情報を1問1答形式で収集します。

### 重要なルール

- **1度に1つの質問のみ**を提示
- 回答を受け取ってから次の質問へ
- **最大5問まで**（所要時間目安: 2-3分）
- 「スキップ」と言われたら次の質問へ

### 質問バンク

以下の質問から、コンテキストに応じて適切なものを選択します：

#### Q1: 学習目標に関する質問
```
📌 この授業/教材で、生徒に達成してほしい具体的な目標は何ですか？
（例: 「一次関数のグラフを正確に描けるようになる」「実験結果を論理的に説明できる」）

💡 スキップする場合は「スキップ」とお伝えください。
```

#### Q2: 学習者レベルに関する質問
```
📌 対象の学習者について教えてください：
- 学年・年齢
- この分野の習熟度（初学者/基礎あり/発展）
- クラスの特徴（人数、雰囲気など）

💡 スキップする場合は「スキップ」とお伝えください。
```

#### Q3: 配慮事項に関する質問
```
📌 特別な配慮が必要な点はありますか？
（例: 学習支援が必要な生徒、言語的背景、興味関心の偏りなど）

💡 特にない場合は「特になし」または「スキップ」とお伝えください。
```

#### Q4: 時間・リソースに関する質問
```
📌 時間やリソースの制約を教えてください：
- 授業時間（例: 45分、50分、90分）
- 使用可能な機材・教材
- 準備にかけられる時間

💡 スキップする場合は「スキップ」とお伝えください。
```

#### Q5: 評価・成功基準に関する質問
```
📌 この授業/教材が「成功した」と言えるのは、どんな状態ですか？
（例: 「全員が基本問題を解ける」「生徒が質問を3つ以上する」）

💡 スキップする場合は「スキップ」とお伝えください。
```

### 真の目的探索質問（オプション）

リクエストの背景にある真の目的を探るため、以下の質問を適宜使用します：

```
🎯 もう少し深くお聞きしてもよいですか？

「この単元で生徒にどのような変化を期待していますか？」

単に知識を得るだけでなく、考え方や態度の変化があれば教えてください。
```

```
🎯 最後に1つだけ確認させてください：

「この授業の成功をどのように判断しますか？」

テストの点数以外で、どんな変化が見られたら嬉しいですか？
```

## Phase 3: メタプロンプト生成

収集した情報を基に、構造化されたメタプロンプトを生成します。

### メタプロンプト構造

```markdown
## 教育コンテンツ生成メタプロンプト

### 【コンテキスト】
- **対象学年**: {学年}
- **教科**: {教科}
- **単元/トピック**: {単元名}
- **授業時間**: {時間}分
- **生徒状況**: {学習者の特徴、習熟度}
- **特別な配慮**: {配慮事項}

### 【学習目標】
{Bloom's Taxonomyに基づいた具体的な学習目標}

### 【参照すべき教育理論】
以下の理論を教育理論データベースから検索し、適用を検討してください：

```bash
# 推奨される理論を検索
npx shiden theories search "{検索キーワード}"
npx shiden theories get {理論ID}
```

- {推奨理論1}（{適用場面}）
- {推奨理論2}（{適用場面}）

### 【出力要件】
- **形式**: {求められる成果物の形式}
- **構成**: {含めるべきセクション}
- **分量**: {目安となる分量}

### 【品質基準】
- {品質基準1}
- {品質基準2}
- {品質基準3}

### 【成功の指標】
{ユーザーが定義した成功基準}
```

## フロー制御

### スキップ処理

ユーザーが「スキップ」と言った場合：
1. その質問の回答はデフォルト値または空欄とする
2. 次の質問に進む
3. メタプロンプト生成時に「情報不足」として明記

### 早期終了

ユーザーが「もう十分」「早く作って」と言った場合：
1. 収集済みの情報でメタプロンプトを生成
2. 不足情報は推測値を使用し、その旨を明記

### 所要時間の目安

コンテキスト収集全体で **2-3分** を目安とします。
5問すべてに回答しても3分以内で完了できるよう、質問は簡潔にします。

## 次のステップ

メタプロンプト生成後、以下のスキルに引き継ぎます：

- 授業計画 → `lesson-plan.md`
- 教材作成 → `materials.md`
- 評価設計 → `assessment.md`
- 個別指導 → `individual.md`
- フィードバック → `feedback.md`
- 生活指導 → `guidance.md`

引き継ぎ時は、生成したメタプロンプトを該当スキルに渡します。
