# アーキテクチャ設計書: SHIDEN - 教育者向けGitHub Copilot Agent Skills

## メタデータ

| 項目 | 値 |
|------|----|
| **ID** | DES-001 |
| **Version** | 1.0.0 |
| **Created** | 2026-01-21 |
| **Updated** | 2026-01-21 |
| **Status** | 📝 Draft → Review Required |
| **Author** | AI Assistant |
| **Phase** | Phase 2: 設計 |
| **Traces To** | REQ-001 |

### MUSUBIX憲法準拠状況

| 条項 | 準拠状況 | 備考 |
|------|---------|------|
| I. Library-First | ✅ 準拠 | npm パッケージとして設計 |
| II. CLI Interface | ✅ 準拠 | `npx shiden init` コマンド設計 |
| III. Test-First | ⏳ 次フェーズ | テスト戦略を定義 |
| IV. EARS Format | ✅ 準拠 | 要件からトレース |
| V. Traceability | ✅ 準拠 | REQ → DES マッピング |
| VI. Project Memory | ✅ 参照 | AGENTS.md参照 |
| VII. Design Patterns | ✅ 適用 | Orchestrator, Strategy, Chain of Responsibility |
| VIII. Decision Records | ✅ 準拠 | ADR-001〜003作成 |
| IX. Quality Gates | ✅ 準拠 | Phase 2完了時にレビュー |
| X. Implementation Prerequisites | ✅ 準拠 | 要件→設計→タスク→実装の順序 |

### トレーサビリティマトリクス（REQ → DES）

| 設計要素 | 対応要件 |
|---------|---------|
| DES-ORCH | REQ-ORCH-001, REQ-META-001〜006 |
| DES-SKILL-LP | REQ-LP-001〜003 |
| DES-SKILL-MAT | REQ-MAT-001〜004 |
| DES-SKILL-ASSESS | REQ-ASSESS-001〜004 |
| DES-SKILL-IEP | REQ-IEP-001〜004 |
| DES-SKILL-FB | REQ-FB-001〜004 |
| DES-SKILL-GUID | REQ-GUID-001〜005 |
| DES-GRAPH | REQ-GRAPH-001〜004, REQ-ORCH-003 |
| DES-DIST | REQ-NFR-001a〜001b, REQ-NFR-001e, REQ-NFR-002〜003 |
| DES-CLI | REQ-NFR-001c (init), REQ-NFR-001d (-v/--version) |

---

## 1. C4モデル

### 1.1 Level 1: System Context Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              System Context                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│    ┌──────────────┐                                     ┌──────────────────┐    │
│    │              │                                     │                  │    │
│    │   教育者     │   教育コンテンツ作成依頼            │    学習者        │    │
│    │  (Teacher)   │ ─────────────────────────────────▶ │   (Learner)      │    │
│    │              │                                     │                  │    │
│    │  小中高教員  │                                     │  教育コンテンツ  │    │
│    │  大学教員    │                                     │  の受益者        │    │
│    └──────┬───────┘                                     └──────────────────┘    │
│           │                                                      ▲              │
│           │ VS Code + GitHub Copilot                             │              │
│           │ で対話                                               │              │
│           ▼                                                      │              │
│    ┌──────────────────────────────────────────────────────────────┴───────┐     │
│    │                                                                      │     │
│    │                    SHIDEN Agent Skills                               │     │
│    │                                                                      │     │
│    │   ┌────────────────────────────────────────────────────────────┐    │     │
│    │   │  • 6つのユースケーススキル（授業計画/教材/評価/個別/FB/指導）│    │     │
│    │   │  • メタプロンプト生成による意図明確化                       │    │     │
│    │   │  • エビデンス（教育理論）に基づくコンテンツ生成            │    │     │
│    │   │  • npm install shiden でインストール可能                   │    │     │
│    │   └────────────────────────────────────────────────────────────┘    │     │
│    │                                                                      │     │
│    └──────────────────────────────────┬───────────────────────────────────┘     │
│                                       │                                          │
│                                       │ MCP Protocol                            │
│                                       │ (教育理論クエリ)                        │
│                                       ▼                                          │
│    ┌──────────────────────────────────────────────────────────────────────┐     │
│    │                                                                      │     │
│    │                    TENJIN GraphRAG MCP Server                        │     │
│    │                                                                      │     │
│    │   ┌────────────────────────────────────────────────────────────┐    │     │
│    │   │  • 175+教育理論のナレッジグラフ                            │    │     │
│    │   │  • 33個のMCP Tools / 15 Resources / 15 Prompts             │    │     │
│    │   │  • Graph + Vector ハイブリッドRAG                          │    │     │
│    │   └────────────────────────────────────────────────────────────┘    │     │
│    │                                                                      │     │
│    └──────────────────────────────────────────────────────────────────────┘     │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 Level 2: Container Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         SHIDEN Agent Skills Package                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                          Orchestration Layer                                │ │
│  │                                                                             │ │
│  │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐   │ │
│  │   │   AGENTS.md     │  │  orchestrator   │  │   meta-prompt           │   │ │
│  │   │                 │  │  .md            │  │   .md                   │   │ │
│  │   │  エントリーポイント│  │                 │  │                         │   │ │
│  │   │  スキルルーティング│  │  意図分析       │  │  プロンプト強化         │   │ │
│  │   │  定義            │  │  スキル選択     │  │  コンテキスト収集       │   │ │
│  │   │                 │  │  連携制御       │  │  真の目的探索           │   │ │
│  │   └─────────────────┘  └─────────────────┘  └─────────────────────────┘   │ │
│  │                                                                             │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
│                                       │                                          │
│                                       ▼                                          │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                           Skill Layer (.github/prompts/)                   │ │
│  │                                                                             │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │ │
│  │  │ lesson-plan  │ │ materials    │ │ assessment   │ │ individual   │      │ │
│  │  │ .md          │ │ .md          │ │ .md          │ │ .md          │      │ │
│  │  │              │ │              │ │              │ │              │      │ │
│  │  │ 授業計画作成 │ │ 教材作成     │ │ 評価設計     │ │ 個別指導計画 │      │ │
│  │  │ 指導案生成   │ │ ワークシート │ │ ルーブリック │ │ 学習戦略提案 │      │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘      │ │
│  │                                                                             │ │
│  │  ┌──────────────┐ ┌──────────────┐                                        │ │
│  │  │ feedback     │ │ guidance     │                                        │ │
│  │  │ .md          │ │ .md          │                                        │ │
│  │  │              │ │              │                                        │ │
│  │  │ フィードバック│ │ 生活指導案   │                                        │ │
│  │  │ 振り返り支援 │ │ 発達段階考慮 │                                        │ │
│  │  └──────────────┘ └──────────────┘                                        │ │
│  │                                                                             │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
│                                       │                                          │
│                                       ▼                                          │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                        Integration Layer (.github/skills/)                  │ │
│  │                                                                             │ │
│  │  ┌──────────────────────────────┐  ┌──────────────────────────────────┐   │ │
│  │  │ theory-lookup.md             │  │ context-manager.md               │   │ │
│  │  │                              │  │                                  │   │ │
│  │  │ TENJIN GraphRAG連携          │  │ セッションコンテキスト管理       │   │ │
│  │  │ • search_theories            │  │ • 会話履歴保持                   │   │ │
│  │  │ • get_theory                 │  │ • 前回情報参照                   │   │ │
│  │  │ • recommend_theories         │  │ • コンテキストクリア             │   │ │
│  │  │ • compare_theories           │  │                                  │   │ │
│  │  └──────────────────────────────┘  └──────────────────────────────────┘   │ │
│  │                                                                             │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
│                                       │                                          │
│                                       ▼                                          │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                        Distribution Layer (npm)                             │ │
│  │                                                                             │ │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────────────┐   │ │
│  │  │ package.json     │  │ bin/shiden.js    │  │ templates/             │   │ │
│  │  │                  │  │                  │  │                        │   │ │
│  │  │ npm メタデータ   │  │ npx shiden init  │  │ コピー対象ファイル     │   │ │
│  │  │ 依存関係定義     │  │ CLIエントリー    │  │ AGENTS.md, prompts/    │   │ │
│  │  └──────────────────┘  └──────────────────┘  └────────────────────────┘   │ │
│  │                                                                             │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 Level 3: Component Diagram - Orchestration Layer

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         Orchestration Layer Components                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                              AGENTS.md                                      │ │
│  │                         (Entry Point Definition)                            │ │
│  ├────────────────────────────────────────────────────────────────────────────┤ │
│  │                                                                             │ │
│  │  # SHIDEN - 教育者向けAgent Skills                                         │ │
│  │                                                                             │ │
│  │  ## システム概要                                                            │ │
│  │  - 教育コンテンツ作成支援                                                   │ │
│  │  - TENJIN GraphRAG連携                                                      │ │
│  │  - 6つのユースケーススキル                                                  │ │
│  │                                                                             │ │
│  │  ## ワークフロー                                                            │ │
│  │  1. メタプロンプト生成フェーズ                                              │ │
│  │  2. スキル実行フェーズ                                                      │ │
│  │  3. 理論引用・エビデンス付与フェーズ                                        │ │
│  │                                                                             │ │
│  │  ## スキルルーティング                                                      │ │
│  │  - 授業計画 → lesson-plan.md                                               │ │
│  │  - 教材作成 → materials.md                                                 │ │
│  │  - 評価設計 → assessment.md                                                │ │
│  │  - 個別指導 → individual.md                                                │ │
│  │  - フィードバック → feedback.md                                            │ │
│  │  - 生活指導 → guidance.md                                                  │ │
│  │                                                                             │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
│                                       │                                          │
│                                       ▼                                          │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                        meta-prompt.md                                       │ │
│  │                   (Prompt Enhancement Component)                            │ │
│  ├────────────────────────────────────────────────────────────────────────────┤ │
│  │                                                                             │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │ │
│  │  │ REQ-META-001: プロンプト強化                                         │  │ │
│  │  ├─────────────────────────────────────────────────────────────────────┤  │ │
│  │  │ Input: ユーザーの初期リクエスト                                      │  │ │
│  │  │ Process:                                                             │  │ │
│  │  │   1. 曖昧な入力を構造化                                              │  │ │
│  │  │   2. 暗黙の前提を明示化                                              │  │ │
│  │  │   3. 欠落要素を特定                                                  │  │ │
│  │  │ Output: 強化されたプロンプト構造                                     │  │ │
│  │  └─────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                             │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │ │
│  │  │ REQ-META-002: 強化プロンプト確認                                     │  │ │
│  │  ├─────────────────────────────────────────────────────────────────────┤  │ │
│  │  │ Template:                                                            │  │ │
│  │  │   📝 あなたのリクエストを以下のように理解しました：                  │  │ │
│  │  │   【元のリクエスト】...                                              │  │ │
│  │  │   【強化されたリクエスト】...                                        │  │ │
│  │  │   👉 この理解で正しいですか？                                        │  │ │
│  │  └─────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                             │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │ │
│  │  │ REQ-META-003: コンテキスト収集（1問1答）                             │  │ │
│  │  ├─────────────────────────────────────────────────────────────────────┤  │ │
│  │  │ Strategy: Sequential Single Question                                 │  │ │
│  │  │   - 1度に1つの質問のみ                                               │  │ │
│  │  │   - 最大5問まで                                                      │  │ │
│  │  │   - 収集した回答を累積保持                                           │  │ │
│  │  │                                                                      │  │ │
│  │  │ Question Bank:                                                       │  │ │
│  │  │   Q1: 学習目標に関する質問                                           │  │ │
│  │  │   Q2: 学習者レベルに関する質問                                       │  │ │
│  │  │   Q3: 配慮事項に関する質問                                           │  │ │
│  │  │   Q4: 時間・リソースに関する質問                                     │  │ │
│  │  │   Q5: 評価基準に関する質問                                           │  │ │
│  │  └─────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                             │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │ │
│  │  │ REQ-META-004: メタプロンプト生成                                     │  │ │
│  │  ├─────────────────────────────────────────────────────────────────────┤  │ │
│  │  │ Output Structure:                                                    │  │ │
│  │  │   【コンテキスト】学年、教科、単元、学習目標、生徒状況、時間        │  │ │
│  │  │   【参照すべき教育理論】TENJIN検索結果                               │  │ │
│  │  │   【出力要件】構成、形式、含めるべき要素                             │  │ │
│  │  │   【品質基準】Bloom's Taxonomy レベル、評価ポイント数               │  │ │
│  │  └─────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                             │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │ │
│  │  │ REQ-META-005: 真の目的探索                                           │  │ │
│  │  ├─────────────────────────────────────────────────────────────────────┤  │ │
│  │  │ Deep Questions:                                                      │  │ │
│  │  │   - 「この単元で生徒にどのような変化を期待していますか？」          │  │ │
│  │  │   - 「この授業の成功をどのように判断しますか？」                    │  │ │
│  │  │   - 「この教材を使って何を達成したいですか？」                      │  │ │
│  │  └─────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                             │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.4 Level 3: Component Diagram - Skill Layer

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            Skill Layer Components                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                     lesson-plan.md (授業計画作成)                         │  │
│  │                                DES-SKILL-LP                              │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-LP-001, REQ-LP-002, REQ-LP-003                              │  │
│  │                                                                           │  │
│  │  Input:                                                                   │  │
│  │    - メタプロンプト（対象学年、教科、単元、学習目標、時間）              │  │
│  │    - TENJIN理論推薦結果                                                  │  │
│  │                                                                           │  │
│  │  Output Structure:                                                        │  │
│  │    1. 学習目標（Bloom's Taxonomy基準）                                   │  │
│  │    2. 導入（5-10分）                                                     │  │
│  │    3. 展開（30-35分）                                                    │  │
│  │    4. まとめ（5-10分）                                                   │  │
│  │    5. 評価規準                                                           │  │
│  │    6. 参照した教育理論（TENJINからの引用）                               │  │
│  │                                                                           │  │
│  │  Theory Integration:                                                      │  │
│  │    - TENJIN: search_theories(category="instructional_design")            │  │
│  │    - TENJIN: recommend_theories_for_learner(context)                     │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                       materials.md (教材作成)                             │  │
│  │                               DES-SKILL-MAT                               │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-MAT-001, REQ-MAT-002, REQ-MAT-003, REQ-MAT-004              │  │
│  │                                                                           │  │
│  │  Format Options:                                                          │  │
│  │    - worksheet: ワークシート形式                                         │  │
│  │    - slide: プレゼンテーションスライド                                   │  │
│  │    - quiz: クイズ・小テスト                                              │  │
│  │    - handout: 配布資料                                                   │  │
│  │                                                                           │  │
│  │  Design Principles:                                                       │  │
│  │    - Gagné's Nine Events of Instruction                                  │  │
│  │    - ARCS Model (Attention, Relevance, Confidence, Satisfaction)         │  │
│  │    - UDL (Universal Design for Learning) for differentiation             │  │
│  │                                                                           │  │
│  │  Theory Integration:                                                      │  │
│  │    - TENJIN: get_theory(id="gagnes_nine_events")                         │  │
│  │    - TENJIN: get_theory(id="arcs_model")                                 │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                       assessment.md (評価設計)                            │  │
│  │                             DES-SKILL-ASSESS                              │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-ASSESS-001, REQ-ASSESS-002, REQ-ASSESS-003, REQ-ASSESS-004  │  │
│  │                                                                           │  │
│  │  Assessment Types:                                                        │  │
│  │    - rubric: ルーブリック（3-5段階評価基準）                             │  │
│  │    - test: テスト問題（認知レベル別）                                    │  │
│  │    - formative: 形成的評価設計                                           │  │
│  │                                                                           │  │
│  │  Cognitive Level Mapping (Bloom's Taxonomy):                             │  │
│  │    Level 1: Remember (記憶)                                              │  │
│  │    Level 2: Understand (理解)                                            │  │
│  │    Level 3: Apply (応用)                                                 │  │
│  │    Level 4: Analyze (分析)                                               │  │
│  │    Level 5: Evaluate (評価)                                              │  │
│  │    Level 6: Create (創造)                                                │  │
│  │                                                                           │  │
│  │  Constructive Alignment Check:                                            │  │
│  │    - 学習目標 ↔ 指導活動 ↔ 評価の整合性確認                             │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                      individual.md (個別指導計画)                         │  │
│  │                              DES-SKILL-IEP                                │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-IEP-001, REQ-IEP-002, REQ-IEP-003, REQ-IEP-004              │  │
│  │                                                                           │  │
│  │  Learner Profile Input:                                                   │  │
│  │    - 学習スタイル（視覚/聴覚/運動感覚）                                  │  │
│  │    - 現在の習熟度                                                        │  │
│  │    - 特別な配慮事項                                                      │  │
│  │                                                                           │  │
│  │  Strategy Recommendation:                                                 │  │
│  │    - 個別化された指導戦略3つ以上                                         │  │
│  │    - 各戦略の理論的根拠                                                  │  │
│  │    - 進捗モニタリング方法                                                │  │
│  │                                                                           │  │
│  │  Theory Integration:                                                      │  │
│  │    - TENJIN: recommend_theories(context="differentiated_instruction")    │  │
│  │    - TENJIN: get_theory(id="zone_of_proximal_development")               │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                       feedback.md (フィードバック)                        │  │
│  │                              DES-SKILL-FB                                 │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-FB-001, REQ-FB-002, REQ-FB-003, REQ-FB-004                  │  │
│  │                                                                           │  │
│  │  Feedback Principles:                                                     │  │
│  │    - Growth Mindset framing (努力・戦略重視)                             │  │
│  │    - Specific and actionable                                             │  │
│  │    - Balanced (strengths + improvements)                                 │  │
│  │                                                                           │  │
│  │  Output Structure:                                                        │  │
│  │    1. 良い点（具体的に）                                                 │  │
│  │    2. 改善点（建設的に）                                                 │  │
│  │    3. 次のステップ（具体的なアクション）                                 │  │
│  │                                                                           │  │
│  │  Metacognition Support:                                                   │  │
│  │    - 自己評価促進の問いかけ                                              │  │
│  │    - 振り返りの観点提示                                                  │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                        guidance.md (生活指導案)                           │  │
│  │                             DES-SKILL-GUID                                │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-GUID-001〜005                                               │  │
│  │                                                                           │  │
│  │  Guidance Types:                                                          │  │
│  │    - preventive: 予防的指導                                              │  │
│  │    - responsive: 対応的指導                                              │  │
│  │    - crisis: 危機対応（※専門家相談推奨を必ず含む）                      │  │
│  │                                                                           │  │
│  │  Developmental Stage Consideration:                                       │  │
│  │    - Erikson's Psychosocial Development                                  │  │
│  │    - Kohlberg's Moral Development                                        │  │
│  │    - Piaget's Cognitive Development                                      │  │
│  │                                                                           │  │
│  │  Output Structure:                                                        │  │
│  │    1. 状況分析                                                           │  │
│  │    2. 発達段階の考慮                                                     │  │
│  │    3. 目標設定                                                           │  │
│  │    4. 具体的介入方法                                                     │  │
│  │    5. 評価・フォローアップ                                               │  │
│  │    6. 保護者連携（必要に応じて）                                         │  │
│  │                                                                           │  │
│  │  ⚠️ Safety Note:                                                         │  │
│  │    危機的状況の場合は必ず「専門家への相談を強く推奨」を含める            │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.5 Level 3: Component Diagram - Integration Layer

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         Integration Layer Components                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                    theory-lookup.md (TENJIN連携)                          │  │
│  │                              DES-GRAPH                                    │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-GRAPH-001, REQ-GRAPH-002, REQ-GRAPH-003, REQ-GRAPH-004      │  │
│  │                                                                           │  │
│  │  TENJIN MCP Tools Integration:                                           │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐    │  │
│  │  │ Search Tools                                                     │    │  │
│  │  ├─────────────────────────────────────────────────────────────────┤    │  │
│  │  │ search_theories(query, category?, limit?)                       │    │  │
│  │  │   → キーワード・意味検索で理論を検索                            │    │  │
│  │  │                                                                  │    │  │
│  │  │ get_theory(theory_id)                                           │    │  │
│  │  │   → 理論の詳細情報を取得                                        │    │  │
│  │  │                                                                  │    │  │
│  │  │ get_theories_by_category(category)                              │    │  │
│  │  │   → カテゴリ別理論一覧                                          │    │  │
│  │  └─────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐    │  │
│  │  │ Recommendation Tools                                             │    │  │
│  │  ├─────────────────────────────────────────────────────────────────┤    │  │
│  │  │ recommend_theories(context, learner_profile?)                   │    │  │
│  │  │   → コンテキストに基づく理論推薦                                │    │  │
│  │  │                                                                  │    │  │
│  │  │ recommend_theories_for_learner(learner_type, learning_goal)     │    │  │
│  │  │   → 学習者タイプ別推薦                                          │    │  │
│  │  │                                                                  │    │  │
│  │  │ recommend_complementary_theories(theory_id)                     │    │  │
│  │  │   → 補完的理論の推薦                                            │    │  │
│  │  └─────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐    │  │
│  │  │ Analysis Tools                                                   │    │  │
│  │  ├─────────────────────────────────────────────────────────────────┤    │  │
│  │  │ compare_theories(theory_ids[])                                  │    │  │
│  │  │   → 複数理論の比較分析                                          │    │  │
│  │  │                                                                  │    │  │
│  │  │ analyze_theory(theory_id, analysis_type)                        │    │  │
│  │  │   → 理論の深層分析                                              │    │  │
│  │  │                                                                  │    │  │
│  │  │ get_theory_applications(theory_id, context)                     │    │  │
│  │  │   → 実践的応用例の取得                                          │    │  │
│  │  └─────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐    │  │
│  │  │ Graph Traversal Tools                                            │    │  │
│  │  ├─────────────────────────────────────────────────────────────────┤    │  │
│  │  │ get_related_theories(theory_id, relation_type?)                 │    │  │
│  │  │   → 関連理論の取得                                              │    │  │
│  │  │                                                                  │    │  │
│  │  │ find_theory_path(from_id, to_id)                                │    │  │
│  │  │   → 理論間のパス探索                                            │    │  │
│  │  │                                                                  │    │  │
│  │  │ get_influence_chain(theory_id)                                  │    │  │
│  │  │   → 影響関係のチェーン取得                                      │    │  │
│  │  └─────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                           │  │
│  │  Error Handling:                                                          │  │
│  │    - TENJIN接続エラー → 汎用的な教授法を適用（フォールバック）         │  │
│  │    - 理論が見つからない → 代替キーワードで再検索                       │  │
│  │    - タイムアウト → ローカルキャッシュ参照（将来実装）                 │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │                  context-manager.md (コンテキスト管理)                    │  │
│  │                            DES-CONTEXT                                    │  │
│  ├──────────────────────────────────────────────────────────────────────────┤  │
│  │  Traces: REQ-ORCH-002, REQ-ORCH-004, REQ-ORCH-005                        │  │
│  │                                                                           │  │
│  │  Session Context:                                                         │  │
│  │    - 会話履歴の保持                                                      │  │
│  │    - 前回のスキル実行結果                                                │  │
│  │    - ユーザー設定（学年、教科のデフォルト）                              │  │
│  │                                                                           │  │
│  │  Context Operations:                                                      │  │
│  │    - remember: 情報を記憶                                                │  │
│  │    - recall: 過去の情報を参照                                            │  │
│  │    - clear: コンテキストをクリア                                         │  │
│  │    - summarize: セッションサマリー生成                                   │  │
│  │                                                                           │  │
│  │  Multi-Skill Orchestration:                                               │  │
│  │    - スキル間データ受け渡し                                              │  │
│  │    - 実行順序の最適化                                                    │  │
│  │    - 依存関係の解決                                                      │  │
│  │                                                                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. ディレクトリ構造

```
shiden/                                    # npm package root
├── AGENTS.md                              # GitHub Copilot Agent Skills entry point
├── .github/
│   ├── prompts/                           # Prompt definitions (Markdown)
│   │   ├── meta-prompt.md                 # メタプロンプト生成
│   │   ├── lesson-plan.md                 # 授業計画作成
│   │   ├── materials.md                   # 教材作成
│   │   ├── assessment.md                  # 評価設計
│   │   ├── individual.md                  # 個別指導計画
│   │   ├── feedback.md                    # フィードバック生成
│   │   └── guidance.md                    # 生活指導案
│   │
│   └── skills/                            # Skill definitions (Markdown)
│       ├── orchestrator.md                # オーケストレーション
│       ├── theory-lookup.md               # TENJIN GraphRAG連携
│       └── context-manager.md             # コンテキスト管理
│
├── bin/
│   └── shiden.js                          # CLI entry point (npx shiden)
│
├── templates/                             # Files to copy on init
│   ├── AGENTS.md
│   ├── .github/
│   │   ├── prompts/
│   │   └── skills/
│   └── README-SHIDEN.md
│
├── src/                                   # TypeScript (minimal, only if needed)
│   ├── cli/
│   │   └── init.ts                        # npx shiden init implementation
│   ├── utils/
│   │   └── file-copy.ts                   # Template file copy utility
│   └── types/
│       └── index.ts                       # Type definitions
│
├── package.json                           # npm package metadata
├── tsconfig.json                          # TypeScript config
├── README.md                              # Package documentation
└── LICENSE                                # MIT License
```

---

## 3. データフロー

### 3.1 メタプロンプト生成フロー

```
User                     SHIDEN                          TENJIN
 │                          │                               │
 │ 初期リクエスト            │                               │
 │ 「数学の授業計画を作って」│                               │
 │─────────────────────────▶│                               │
 │                          │                               │
 │                          │ 1. プロンプト強化             │
 │                          │ (meta-prompt.md)              │
 │                          │                               │
 │ 強化プロンプト確認        │                               │
 │◀─────────────────────────│                               │
 │                          │                               │
 │ 「はい」or 修正           │                               │
 │─────────────────────────▶│                               │
 │                          │                               │
 │                          │ 2. コンテキスト収集           │
 │ Q1: 学習目標は？          │ (1問1答)                     │
 │◀─────────────────────────│                               │
 │                          │                               │
 │ 回答                      │                               │
 │─────────────────────────▶│                               │
 │                          │                               │
 │ Q2: 生徒の理解度は？      │                               │
 │◀─────────────────────────│                               │
 │                          │                               │
 │ 回答                      │                               │
 │─────────────────────────▶│                               │
 │                          │                               │
 │                          │ 3. 理論検索                   │
 │                          │────────────────────────────▶│
 │                          │                               │
 │                          │ 推薦理論リスト                │
 │                          │◀────────────────────────────│
 │                          │                               │
 │                          │ 4. メタプロンプト生成         │
 │                          │                               │
 │ メタプロンプト表示        │                               │
 │◀─────────────────────────│                               │
 │                          │                               │
 │ 承認 or 修正              │                               │
 │─────────────────────────▶│                               │
 │                          │                               │
 │                          │ 5. スキル実行                 │
 │                          │ (lesson-plan.md)              │
 │                          │                               │
 │ 授業計画（理論引用付き）  │                               │
 │◀─────────────────────────│                               │
 │                          │                               │
```

### 3.2 スキル実行フロー

```
SHIDEN Orchestrator         Skill (Prompt)              TENJIN GraphRAG
       │                          │                           │
       │ スキル選択                │                           │
       │ (意図分析結果に基づく)    │                           │
       │─────────────────────────▶│                           │
       │                          │                           │
       │                          │ 理論検索クエリ生成        │
       │                          │──────────────────────────▶│
       │                          │                           │
       │                          │    search_theories()      │
       │                          │    recommend_theories()   │
       │                          │                           │
       │                          │ 関連理論リスト            │
       │                          │◀──────────────────────────│
       │                          │                           │
       │                          │ コンテンツ生成            │
       │                          │ (理論を引用・統合)        │
       │                          │                           │
       │ 生成結果（理論引用付き）  │                           │
       │◀─────────────────────────│                           │
       │                          │                           │
       │ 品質チェック             │                           │
       │ (理論引用率≥80%)         │                           │
       │                          │                           │
       │ ユーザーへ出力           │                           │
       │                          │                           │
```

---

## 4. 適用設計パターン

### 4.1 Orchestrator Pattern

**目的**: 複数のスキル（授業計画、教材、評価等）を統合的に制御

**適用箇所**: `AGENTS.md`, `orchestrator.md`

**実装**:
- ユーザー意図を分析し、適切なスキルにルーティング
- マルチスキル連携時の実行順序制御
- フォールバック処理の管理

### 4.2 Chain of Responsibility Pattern

**目的**: メタプロンプト生成のフローを段階的に処理

**適用箇所**: `meta-prompt.md`

**チェーン**:
1. プロンプト強化
2. 強化プロンプト確認
3. コンテキスト収集（1問1答）
4. メタプロンプト生成
5. スキル実行

各段階でユーザーがスキップ可能（急ぎの場合）

### 4.3 Strategy Pattern

**目的**: ユースケースに応じたスキル戦略の切り替え

**適用箇所**: 各スキルプロンプト (`lesson-plan.md`, `materials.md` 等)

**戦略**:
- 授業計画戦略: Bloom's Taxonomy基準の目標設定
- 教材戦略: Gagné/ARCS基準の設計
- 評価戦略: Constructive Alignment基準

### 4.4 Adapter Pattern

**目的**: TENJIN GraphRAGとの連携を抽象化

**適用箇所**: `theory-lookup.md`

**実装**:
- TENJIN MCP Toolsへの統一的なインターフェース
- エラーハンドリングとフォールバック
- 結果のフォーマット変換

---

## 5. Architecture Decision Records (ADR)

### ADR-001: Markdown-First Implementation

**ステータス**: Accepted

**コンテキスト**:
GitHub Copilot Agent Skillsの実装方式を選定する必要がある。

**決定**:
Markdownベースのプロンプト定義を優先し、TypeScriptは必要最小限に抑える。

**理由**:
1. GitHub Copilot Agent Skillsの標準的な実装方式
2. 宣言的で可読性が高い
3. AIエージェントとの親和性が高い
4. 教員ユーザーが内容を理解・カスタマイズしやすい

**結果**:
- `.github/prompts/`: 6つのユースケーススキル（Markdown）
- `.github/skills/`: 統合スキル（Markdown）
- `src/`: CLIとユーティリティのみ（TypeScript）

---

### ADR-002: Sequential Single Question Context Collection

**ステータス**: Accepted

**コンテキスト**:
メタプロンプト生成時のコンテキスト収集方式を決定する必要がある。

**決定**:
1問1答形式で順次質問を行い、コンテキストを収集する。

**理由**:
1. ユーザー負担の軽減（一度に大量の質問を避ける）
2. 回答に基づいて次の質問を調整可能
3. 必要十分なコンテキストが収集できた時点で終了可能
4. 対話的で自然なUX

**結果**:
- 最大5問の質問バンク
- 各質問は具体的かつ回答しやすい形式
- 収集した回答を累積的に保持

---

### ADR-003: TENJIN GraphRAG Integration via MCP

**ステータス**: Accepted

**コンテキスト**:
教育理論データへのアクセス方式を決定する必要がある。

**決定**:
TENJIN GraphRAG MCPサーバーとMCP Protocol経由で連携する。

**理由**:
1. 175+の教育理論への統一的アクセス
2. GraphRAG（Graph + Vector）による高精度な検索
3. MCPによる標準化されたインターフェース
4. 理論間の関係性を活用した推薦

**TENJIN使用ツール**:
- `search_theories`: キーワード・意味検索
- `get_theory`: 詳細情報取得
- `recommend_theories`: コンテキスト推薦
- `compare_theories`: 理論比較
- `get_related_theories`: 関連理論探索

**結果**:
- `theory-lookup.md`でTENJIN連携を一元管理
- エラーハンドリング（接続エラー時のフォールバック）
- 理論引用率80%以上を目標

---

## 6. 非機能設計

### 6.1 配布設計

```
package.json
{
  "name": "shiden",
  "version": "1.0.0",
  "description": "教育者向けGitHub Copilot Agent Skills",
  "main": "dist/index.js",
  "bin": {
    "shiden": "./bin/shiden.js"
  },
  "files": [
    "dist/",
    "bin/",
    "templates/",
    "AGENTS.md",
    ".github/"
  ],
  "scripts": {
    "build": "tsc",
    "prepublishOnly": "npm run build"
  },
  "keywords": [
    "github-copilot",
    "agent-skills",
    "education",
    "teaching",
    "lesson-plan"
  ],
  "dependencies": {
    // 最小限に抑える
  },
  "peerDependencies": {
    // なし（スタンドアロンで動作）
  }
}
```

### 6.2 CLI設計

**Traces**: REQ-NFR-001c, REQ-NFR-001d

```bash
# インストール
npm install shiden

# セットアップ（Agent Skillsファイルをプロジェクトにコピー）
npx shiden init

# バージョン表示 (REQ-NFR-001d)
npx shiden -v                 # バージョン表示（短縮形式）
npx shiden --version          # バージョン表示（完全形式）
# 出力例: shiden v1.0.0

# その他オプション
npx shiden init --force       # 既存ファイルを上書き
npx shiden init --dry-run     # プレビューのみ
npx shiden help               # ヘルプ表示
npx shiden -h                 # ヘルプ表示（短縮形式）
```

#### CLIコマンド一覧

| コマンド | 説明 | 対応要件 |
|---------|------|----------|
| `shiden init` | Agent Skillsファイルをプロジェクトにコピー | REQ-NFR-001c |
| `shiden -v`, `--version` | バージョン表示 (`shiden vX.Y.Z`) | REQ-NFR-001d |
| `shiden -h`, `help` | ヘルプ表示 | - |

### 6.3 品質基準

| 指標 | 目標値 |
|------|--------|
| 教育理論引用率 | ≥80% |
| スキルルーティング精度 | ≥90% |
| 初期応答時間 | ≤5秒 |
| npm install成功率 | 100% |
| コンテキスト収集質問数 | ≤5問 |

---

## 7. 改訂履歴

| バージョン | 日付 | 変更内容 | 著者 |
|-----------|------|---------|------|
| 1.0.0 | 2026-01-21 | 初版作成（C4モデル、コンポーネント設計、ADR） | AI Assistant |
| 1.0.1 | 2026-01-21 | CLI設計更新: -v/--versionオプション追加 (REQ-NFR-001d対応) | AI Assistant |

---

## 8. 承認

| 役割 | 名前 | 日付 | 署名 |
|------|------|------|------|
| プロダクトオーナー | | | |
| 技術リード | | | |
