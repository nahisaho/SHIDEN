# SHIDEN-TENJIN ç›´æ¥çµ±åˆ è¨­è¨ˆæ›¸

## ğŸ“‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| **è¨­è¨ˆID** | DES-SHIDEN-INT-v0.3.0 |
| **å¯¾å¿œè¦ä»¶** | REQ-SHIDEN-INT-v0.3.0 |
| **ä½œæˆæ—¥** | 2026-01-21 |
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³** | 0.3.0 |

---

## ğŸ—ï¸ C4ãƒ¢ãƒ‡ãƒ«

### Level 1: System Context

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•™è‚²è€…ï¼ˆUserï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1. æˆæ¥­è¨ˆç”»ä¾é ¼
                              â”‚ 2. ç†è«–æ¤œç´¢
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitHub Copilot                                â”‚
â”‚                  (Agent Mode + Skills)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Skillå‘¼ã³å‡ºã—
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SHIDEN v0.3.0                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚              â”‚   æ•™è‚²ç†è«–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (SQLite)   â”‚                â”‚
â”‚              â”‚        175+ Theories            â”‚                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ ã‚ªãƒ—ã‚·ãƒ§ãƒ³é€£æº
                              â–¼
â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
â”‚                    TENJIN MCP Server                             â”‚
â”‚              (Neo4j + ChromaDB + Redis)                          â”‚
â”‚              â€» é«˜åº¦ãªæ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆã®ã¿                         â”‚
â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
```

---

### Level 2: Container Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SHIDEN Package                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚     CLI      â”‚    â”‚    Skills    â”‚    â”‚  Templates   â”‚       â”‚
â”‚  â”‚   (Commander)â”‚    â”‚   (*.md)     â”‚    â”‚              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                   â”‚                                    â”‚
â”‚         â”‚  theories cmd     â”‚  theory-lookup                     â”‚
â”‚         â–¼                   â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  TheoryService                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚   search()  â”‚  â”‚    get()    â”‚  â”‚  related()  â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  TheoryRepository                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚ searchFTS() â”‚  â”‚ findById()  â”‚  â”‚ traverse()  â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              SQLite Database (better-sqlite3)            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ theories  â”‚  â”‚ theory_relationsâ”‚  â”‚ theories_fts â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  (175+)   â”‚  â”‚    (graph)      â”‚  â”‚  (trigram)   â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 data/theories.db (ãƒãƒ³ãƒ‰ãƒ«)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Level 3: Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        src/                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  cli/                                                            â”‚
â”‚  â”œâ”€â”€ index.ts           # ãƒ¡ã‚¤ãƒ³CLIã‚¨ãƒ³ãƒˆãƒª                      â”‚
â”‚  â”œâ”€â”€ commands/                                                   â”‚
â”‚  â”‚   â”œâ”€â”€ init.ts        # npx shiden init                       â”‚
â”‚  â”‚   â””â”€â”€ theories.ts    # npx shiden theories <cmd>  [NEW]      â”‚
â”‚  â”‚                                                               â”‚
â”‚  theories/                                         [NEW]         â”‚
â”‚  â”œâ”€â”€ index.ts           # å…¬é–‹API                                â”‚
â”‚  â”œâ”€â”€ TheoryService.ts   # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯                        â”‚
â”‚  â”œâ”€â”€ TheoryRepository.ts# ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤                        â”‚
â”‚  â”œâ”€â”€ database.ts        # SQLiteæ¥ç¶šç®¡ç†                         â”‚
â”‚  â””â”€â”€ types.ts           # å‹å®šç¾©                                 â”‚
â”‚                                                                  â”‚
â”‚  data/                                             [NEW]         â”‚
â”‚  â””â”€â”€ theories.db        # ãƒãƒ³ãƒ‰ãƒ«SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

### DES-001: TheoryService

**å¯¾å¿œè¦ä»¶**: REQ-SHIDEN-INT-001ã€œ008

```typescript
// src/theories/TheoryService.ts

export interface TheoryService {
  /**
   * FTS5ã‚’ä½¿ç”¨ã—ãŸç†è«–æ¤œç´¢
   * @param query æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆæ—¥æœ¬èª/è‹±èªï¼‰
   * @param options æ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³
   * @returns ãƒãƒƒãƒã—ãŸç†è«–ã®ãƒªã‚¹ãƒˆ
   */
  search(query: string, options?: SearchOptions): Promise<Theory[]>;

  /**
   * IDã«ã‚ˆã‚‹ç†è«–å–å¾—
   * @param id ç†è«–ID (e.g., "theory-001")
   * @returns ç†è«–è©³ç´°ã¾ãŸã¯null
   */
  get(id: string): Promise<Theory | null>;

  /**
   * å…¨ç†è«–ä¸€è¦§å–å¾—
   * @param options ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ•ã‚£ãƒ«ã‚¿
   * @returns ç†è«–ãƒªã‚¹ãƒˆ
   */
  list(options?: ListOptions): Promise<Theory[]>;

  /**
   * ã‚«ãƒ†ã‚´ãƒªä¸€è¦§å–å¾—
   * @returns ã‚«ãƒ†ã‚´ãƒªã¨ãã®ä»¶æ•°
   */
  categories(): Promise<Category[]>;

  /**
   * é–¢é€£ç†è«–ã®ã‚°ãƒ©ãƒ•èµ°æŸ»
   * @param id èµ·ç‚¹ã¨ãªã‚‹ç†è«–ID
   * @param depth èµ°æŸ»æ·±ã•ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2, æœ€å¤§: 3ï¼‰
   * @returns é–¢é€£ç†è«–ã®ãƒ„ãƒªãƒ¼æ§‹é€ 
   */
  related(id: string, depth?: number): Promise<RelatedTheory[]>;
}
```

---

### DES-002: TheoryRepository

**å¯¾å¿œè¦ä»¶**: REQ-SHIDEN-INT-002, 005

```typescript
// src/theories/TheoryRepository.ts

export interface TheoryRepository {
  /**
   * FTS5 trigramæ¤œç´¢
   */
  searchFTS(query: string, limit?: number): Theory[];

  /**
   * IDæ¤œç´¢
   */
  findById(id: string): Theory | null;

  /**
   * å…¨ä»¶å–å¾—
   */
  findAll(options?: { category?: string; limit?: number; offset?: number }): Theory[];

  /**
   * ã‚«ãƒ†ã‚´ãƒªé›†è¨ˆ
   */
  countByCategory(): { category: string; count: number }[];

  /**
   * WITH RECURSIVE CTEã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•èµ°æŸ»
   */
  traverseRelated(id: string, maxDepth: number): RelatedTheory[];
}
```

---

### DES-003: Database Connection

**å¯¾å¿œè¦ä»¶**: REQ-SHIDEN-INT-001, 007

```typescript
// src/theories/database.ts

import Database from 'better-sqlite3';
import path from 'path';

let db: Database.Database | null = null;

/**
 * SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’å–å¾—ï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ï¼‰
 */
export function getDatabase(): Database.Database {
  if (!db) {
    const dbPath = path.join(__dirname, '..', 'data', 'theories.db');
    db = new Database(dbPath, { readonly: true });
    db.pragma('journal_mode = WAL');
  }
  return db;
}

/**
 * ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’é–‰ã˜ã‚‹
 */
export function closeDatabase(): void {
  if (db) {
    db.close();
    db = null;
  }
}
```

---

### DES-004: å‹å®šç¾©

```typescript
// src/theories/types.ts

export interface Theory {
  id: string;
  name: string;
  name_ja: string | null;
  category: string;
  description: string | null;
  description_ja: string | null;
  theorists: string[];
  priority: number;
  key_principles: string[];
  applications: string[];
  strengths: string[];
  limitations: string[];
}

export interface RelatedTheory extends Theory {
  depth: number;
  relation_type: 'related_to' | 'influenced_by' | 'influences';
}

export interface Category {
  name: string;
  count: number;
}

export interface SearchOptions {
  category?: string;
  limit?: number;
}

export interface ListOptions {
  category?: string;
  limit?: number;
  offset?: number;
}
```

---

### DES-005: CLI Commands

**å¯¾å¿œè¦ä»¶**: REQ-SHIDEN-INT-008

```typescript
// src/cli/commands/theories.ts

import { Command } from 'commander';
import { createTheoryService } from '../../theories';

export function createTheoriesCommand(): Command {
  const theories = new Command('theories')
    .description('æ•™è‚²ç†è«–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œ');

  theories
    .command('list')
    .description('ç†è«–ä¸€è¦§ã‚’è¡¨ç¤º')
    .option('-c, --category <category>', 'ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿')
    .option('-l, --limit <number>', 'è¡¨ç¤ºä»¶æ•°', '20')
    .action(async (options) => { /* ... */ });

  theories
    .command('search <query>')
    .description('ç†è«–ã‚’æ¤œç´¢ï¼ˆFTS5ï¼‰')
    .option('-l, --limit <number>', 'è¡¨ç¤ºä»¶æ•°', '10')
    .action(async (query, options) => { /* ... */ });

  theories
    .command('get <id>')
    .description('ç†è«–ã®è©³ç´°ã‚’å–å¾—')
    .action(async (id) => { /* ... */ });

  theories
    .command('categories')
    .description('ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ã‚’è¡¨ç¤º')
    .action(async () => { /* ... */ });

  theories
    .command('related <id>')
    .description('é–¢é€£ç†è«–ã‚’å–å¾—')
    .option('-d, --depth <number>', 'èµ°æŸ»æ·±ã•', '2')
    .action(async (id, options) => { /* ... */ });

  return theories;
}
```

---

### DES-006: Skill Integration

**å¯¾å¿œè¦ä»¶**: REQ-SHIDEN-INT-002, 003

```markdown
<!-- templates/.github/skills/theory-lookup.md -->

---
name: theory-lookup
description: æ•™è‚²ç†è«–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ç†è«–ã‚’æ¤œç´¢ãƒ»å–å¾—
---

# Theory Lookup

## ä½¿ç”¨æ–¹æ³•

### æ¤œç´¢
```bash
npx shiden theories search "èªçŸ¥è² è·"
```

### è©³ç´°å–å¾—
```bash
npx shiden theories get theory-001
```

### é–¢é€£ç†è«–
```bash
npx shiden theories related theory-001 --depth 2
```

## ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

æ¤œç´¢çµæœã¯ä»¥ä¸‹ã®å½¢å¼ã§è¿”å´ã•ã‚Œã¾ã™ï¼š

- **id**: ç†è«–ID
- **name**: ç†è«–åï¼ˆè‹±èªï¼‰
- **name_ja**: ç†è«–åï¼ˆæ—¥æœ¬èªï¼‰
- **category**: ã‚«ãƒ†ã‚´ãƒª
- **description**: èª¬æ˜
```

---

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
shiden/
â”œâ”€â”€ package.json          # better-sqlite3 ä¾å­˜è¿½åŠ 
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â”œâ”€â”€ index.ts      # theories ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â”œâ”€â”€ init.ts
â”‚   â”‚       â””â”€â”€ theories.ts    [NEW]
â”‚   â”œâ”€â”€ theories/              [NEW]
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ TheoryService.ts
â”‚   â”‚   â”œâ”€â”€ TheoryRepository.ts
â”‚   â”‚   â”œâ”€â”€ database.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ data/                  [NEW]
â”‚       â””â”€â”€ theories.db
â””â”€â”€ templates/
    â””â”€â”€ .github/
        â””â”€â”€ skills/
            â””â”€â”€ theory-lookup.md  [UPDATE]
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### DF-001: ç†è«–æ¤œç´¢ãƒ•ãƒ­ãƒ¼

```
User â†’ CLI "theories search èªçŸ¥"
         â†“
    TheoryService.search("èªçŸ¥")
         â†“
    TheoryRepository.searchFTS("èªçŸ¥")
         â†“
    SQLite FTS5 Query:
    SELECT * FROM theories_fts WHERE theories_fts MATCH 'èªçŸ¥'
         â†“
    çµæœã‚’ Theory[] ã«å¤‰æ›
         â†“
    CLI ãŒæ•´å½¢ã—ã¦è¡¨ç¤º
```

### DF-002: ã‚°ãƒ©ãƒ•èµ°æŸ»ãƒ•ãƒ­ãƒ¼

```
User â†’ CLI "theories related theory-001 --depth 2"
         â†“
    TheoryService.related("theory-001", 2)
         â†“
    TheoryRepository.traverseRelated("theory-001", 2)
         â†“
    SQLite WITH RECURSIVE CTE:
    WITH RECURSIVE related_graph AS (...)
         â†“
    çµæœã‚’ RelatedTheory[] ã«å¤‰æ›
         â†“
    CLI ãŒãƒ„ãƒªãƒ¼å½¢å¼ã§è¡¨ç¤º
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### UT-001: TheoryRepository

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | å†…å®¹ |
|-------------|------|
| searchFTS_japanese | æ—¥æœ¬èªæ¤œç´¢ãŒå‹•ä½œã™ã‚‹ |
| searchFTS_english | è‹±èªæ¤œç´¢ãŒå‹•ä½œã™ã‚‹ |
| searchFTS_empty | ç©ºã‚¯ã‚¨ãƒªã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ |
| findById_exists | å­˜åœ¨ã™ã‚‹IDã§ç†è«–ã‚’å–å¾— |
| findById_notExists | å­˜åœ¨ã—ãªã„IDã§null |
| traverseRelated_depth1 | æ·±ã•1ã§ç›´æ¥é–¢é€£ã®ã¿ |
| traverseRelated_depth3 | æ·±ã•3ã§3éšå±¤ã¾ã§å–å¾— |

### UT-002: TheoryService

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | å†…å®¹ |
|-------------|------|
| search_withCategory | ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãŒå‹•ä½œ |
| list_pagination | ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ä½œ |
| categories_count | ã‚«ãƒ†ã‚´ãƒªä»¶æ•°ãŒæ­£ç¢º |

### IT-001: CLIçµ±åˆãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | å†…å®¹ |
|-------------|------|
| cli_theories_list | `theories list` ãŒå‹•ä½œ |
| cli_theories_search | `theories search` ãŒå‹•ä½œ |
| cli_theories_get | `theories get` ãŒå‹•ä½œ |
| cli_theories_related | `theories related` ãŒå‹•ä½œ |

---

## ğŸ“Š ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ãƒãƒˆãƒªã‚¯ã‚¹

| è¦ä»¶ID | è¨­è¨ˆID | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
|--------|--------|---------------|
| REQ-001 | DES-003 | database.ts |
| REQ-002 | DES-001, DES-002 | TheoryService, TheoryRepository |
| REQ-003 | DES-001, DES-002 | TheoryService.get() |
| REQ-004 | DES-001 | TheoryService.categories() |
| REQ-005 | DES-002 | TheoryRepository.traverseRelated() |
| REQ-006 | - | (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ä»Šå›ã‚¹ã‚³ãƒ¼ãƒ—å¤–) |
| REQ-007 | DES-003 | database.ts (readonly) |
| REQ-008 | DES-005 | theories.ts (CLI) |

---

## ğŸ“‹ ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

| è¦³ç‚¹ | çŠ¶æ…‹ | è©³ç´° |
|------|------|------|
| C4ãƒ¢ãƒ‡ãƒ« | âœ… OK | Context/Container/Componentå®šç¾©æ¸ˆã¿ |
| å‹å®šç¾© | âœ… OK | TypeScript interfaceå®šç¾©æ¸ˆã¿ |
| ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ | âœ… OK | æ¤œç´¢ãƒ»ã‚°ãƒ©ãƒ•èµ°æŸ»ãƒ•ãƒ­ãƒ¼æ˜ç¢º |
| ãƒ†ã‚¹ãƒˆè¨ˆç”» | âœ… OK | UT/ITå®šç¾©æ¸ˆã¿ |
| ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ | âœ… OK | å…¨è¦ä»¶â†’è¨­è¨ˆã®ãƒãƒƒãƒ”ãƒ³ã‚°å®Œäº† |

---

ğŸ‘‰ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„:**
- ã€Œä¿®æ­£ã€/ å…·ä½“çš„ãªä¿®æ­£æŒ‡ç¤º â†’ ä¿®æ­£ã—ã¦å†æç¤º
- ã€Œæ‰¿èªã€/ã€ŒOKã€/ã€Œé€²ã‚ã‚‹ã€ â†’ **ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ•ã‚§ãƒ¼ã‚ºã¸**
